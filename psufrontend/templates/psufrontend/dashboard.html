{% extends 'base.html' %}
{% load i18n %}
{% load extra_utils %}

{% block title %}{% trans "Dashboard" %} - Plant Supply Unit{% endblock title %}{% trans "Dashboard" %}

{% block head %}
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
{% endblock head %}

{% block body %}
	{% include "psufrontend/status.html" %}

	<div class="row">
		<div class="col-md-4">
			<h5>{% trans "MY PSUs:" %}</h5>
			<hr>
			<div class="card card-body">
				<a class="btn btn-primary  btn-sm btn-block" href="{% url 'psufrontend:register_psu' %}">Add new PSU</a>
				<table class="table table-sm">
					<thead>
						<tr>
							<th>{% trans "Identity key" %}</th>
							<th>{% trans "Name" %}</th>
						</tr>
					</thead>

					<tbody>
						{% for p in psus %}
							<tr>
								<td>{{ p.id }}</td>
								<td><a class="{% if p.id == sel_psu.id %}selected{% endif %}"href="{% url 'psufrontend:dashboard' psu=p.id %}">{{ p.pretty_name }}</a><td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>

		<div class="col-md-8">
			<h5>{% trans "LAST 8 MEASUREMENTS:" %}</h5>
			<hr>
			<div class="card card-body">
				<a class="btn btn-primary  btn-sm btn-block" href="{% url 'psufrontend:add_watering_task' %}">Manually water the plant</a>
			    <table class="table table-sm">
			      <!-- table head -->
			      <thead>
			        <tr>
			          <th style="flex: 1.5;">{% trans "Timestamp" %}</th>
			          <th>{% trans "Temperature" %}</th>
			          <th>{% trans "Air Humidity" %}</th>
			          <th>{% trans "Ground Humidity" %}</th>
			          <th>{% trans "Brightness" %}</th>
			        </tr>
			      </thead>

			      <!-- table body with measurements -->
			      <tbody>
			        {% for d in lastmeasurements %}
			          <tr>
			            <td style="flex: 1.5;">{{ d.timestamp }}</td>
			            <td>{{ d.temperature | round:1 }} °C</td>
			            <td>{{ d.air_humidity | round:1 }} %</td>
			            <td>{{ d.ground_humidity | round:1 }} %</td>
			            <td>{{ d.brightness | round:0 }} %</td>
			          </tr>
			        {% endfor %}
			      </tbody>
			    </table>
			</div>
		</div>

	</div>

	<div class="row">
		<div class="col-md-6">
    	<h5>{% trans "Image:" %}</h5>
	    <hr>
		</div>

	    <div class="col-md-4">
	    <h5>{% trans "Current Fill Level:" %}</h5>
	    <hr>
        <div id = "filllevel">
        <canvas id="myChart2"></canvas>
        </div>
        <script>
                let myChart2 = document.getElementById("myChart2").getContext('2d');

            
            
            let full_l = [{{lastmeasurement.fill_level | round:0 }}, 100-{{lastmeasurement.fill_level | round:0 }}];
            
            let label2 = ['water', ''];
            let color2 = ['#0400d7', '#ffffff']
            
           
           

                let chart2 = new Chart(myChart2, {
                type: 'doughnut',
                data: {
                    labels: label2,
                    datasets: [ {
                        label: 'Fill level',
                        data: full_l,
                        backgroundColor: color2
                    }]
                    },
                    options: {
                        title: {
                        text: "Füllstand",
                        display: true
                        }
                    }
            })


        </script>
    	</div>
    </div>


{% endblock %}